<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Equipment Manager</title>

<style>
  body { font-family:-apple-system,BlinkMacSystemFont,sans-serif; background:#111; color:#eee; padding:20px; }
  .wrap { max-width:760px; margin:auto; }
  .card { background:#1c1c1c; padding:18px; border-radius:12px; margin-bottom:16px; }
  h1 { margin: 0 0 12px; }
  h2 { margin: 0 0 10px; font-size: 1.05rem; }
  .small { font-size:.85rem; opacity:.7; margin-top:6px; }
  label { display:block; margin:10px 0 6px; font-weight:600; }
  input, select { width:100%; padding:10px; border-radius:8px; border:1px solid #333; background:#222; color:#fff; }
  .row { display:grid; grid-template-columns: 1.2fr .9fr .7fr; gap:10px; align-items:center; margin:10px 0; }
  .row .btn { width:100%; }
  .btnbar { display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
  button { padding:10px 14px; border-radius:10px; border:none; cursor:pointer; background:#2e7dff; color:white; }
  button.ghost { background:#444; }
  button.danger { background:#b33a3a; }
  a { color:#2e7dff; text-decoration:none; }
  hr { border:none; border-top:1px solid #333; margin:14px 0; }
</style>
</head>

<body>
<div class="wrap">
  <h1>Equipment Manager</h1>
  <p class="small">This page saves to your device (localStorage). You can redo the UI later without losing data as long as the key stays the same.</p>

  <!-- KETTLEBELLS -->
  <div class="card">
    <h2>üîî Kettlebells</h2>
    <div id="kbList"></div>
    <div class="btnbar">
      <button id="addKb">+ Add kettlebell</button>
    </div>
    <p class="small">Example: 50 lb √ó 2 (for double carries / double front rack)</p>
  </div>

  <!-- DUMBBELLS -->
  <div class="card">
    <h2>üèãÔ∏è Dumbbells</h2>
    <label>Type</label>
    <select id="dbType">
      <option value="pairs" selected>Pairs</option>
      <option value="singles">Singles</option>
    </select>

    <div id="dbList"></div>
    <div class="btnbar">
      <button id="addDb">+ Add dumbbell</button>
    </div>
    <p class="small">Your setup: 30/35/40 pairs + one single 25.</p>
  </div>

  <!-- PLATES -->
  <div class="card">
    <h2>‚ö™ Plates</h2>
    <div id="plateList"></div>
    <div class="btnbar">
      <button id="addPlate">+ Add plate size</button>
    </div>
    <p class="small">Use quantity as ‚Äúnumber of plates‚Äù (not pairs). Example: 45 √ó 2 means two 45s.</p>
  </div>

  <!-- BARS -->
  <div class="card">
    <h2>‚Äî Bars</h2>
    <label>Olympic bar (lbs)</label>
    <input id="olympicBar" placeholder="45" />

    <label>EZ curl bar (lbs)</label>
    <input id="ezBar" placeholder="20" />

    <label>Other bars (optional notes)</label>
    <input id="otherBars" placeholder="Trap bar, curl bar, etc" />

    <p class="small">If you don‚Äôt know exact EZ bar weight, you can leave it blank for now.</p>
  </div>

  <div class="card">
    <div class="btnbar">
      <button id="save">Save ‚úÖ</button>
      <button id="reset" class="danger">Reset to defaults</button>
      <button id="wipe" class="ghost">Wipe saved data</button>
    </div>
    <p id="status" class="small"></p>
  </div>

  <a href="index.html">‚Üê Back to Workout</a>
</div>

<script>
const KEY = "dk_equipment_v1";

// ---------- helpers ----------
const qtySelect = (value=1, max=6) => {
  const sel = document.createElement("select");
  for (let i=1; i<=max; i++) {
    const opt = document.createElement("option");
    opt.value = String(i);
    opt.textContent = String(i);
    if (i === value) opt.selected = true;
    sel.appendChild(opt);
  }
  return sel;
};

function makeRow({weight=0, qty=1}, onRemove) {
  const wrap = document.createElement("div");
  wrap.className = "row";

  const w = document.createElement("input");
  w.type = "number";
  w.min = "0";
  w.step = "0.5";
  w.placeholder = "Weight (lbs)";
  w.value = weight ? String(weight) : "";

  const q = qtySelect(qty, 8);

  const rm = document.createElement("button");
  rm.className = "ghost btn";
  rm.textContent = "Remove";
  rm.onclick = onRemove;

  wrap.appendChild(w);
  wrap.appendChild(q);
  wrap.appendChild(rm);

  return { wrap, w, q };
}

function normalizeItems(items) {
  return (items || [])
    .map(x => ({ weight: Number(x.weight), qty: Number(x.qty || 1) }))
    .filter(x => Number.isFinite(x.weight) && x.weight > 0 && Number.isFinite(x.qty) && x.qty > 0)
    .sort((a,b) => a.weight - b.weight);
}

function setStatus(msg) {
  document.getElementById("status").textContent = msg;
}

// ---------- state ----------
let state = {
  kettlebells: [],
  dumbbells: { pairs: [], singles: [] },
  plates: [],
  bars: { olympic: 45, ez: null, other: "" }
};

// ---------- renderers ----------
function renderKB() {
  const list = document.getElementById("kbList");
  list.innerHTML = "";
  state.kettlebells.forEach((item, idx) => {
    const row = makeRow(item, () => { state.kettlebells.splice(idx,1); renderKB(); });
    row.wrap.dataset.kind = "kb";
    row.wrap.dataset.idx = idx;
    list.appendChild(row.wrap);
  });
}

function renderDB() {
  const list = document.getElementById("dbList");
  list.innerHTML = "";

  const type = document.getElementById("dbType").value; // pairs or singles
  const arr = state.dumbbells[type];

  arr.forEach((item, idx) => {
    const row = makeRow(item, () => { arr.splice(idx,1); renderDB(); });
    row.wrap.dataset.kind = "db";
    row.wrap.dataset.type = type;
    row.wrap.dataset.idx = idx;
    list.appendChild(row.wrap);
  });
}

function renderPlates() {
  const list = document.getElementById("plateList");
  list.innerHTML = "";
  state.plates.forEach((item, idx) => {
    const row = makeRow(item, () => { state.plates.splice(idx,1); renderPlates(); });
    row.wrap.dataset.kind = "plate";
    row.wrap.dataset.idx = idx;
    list.appendChild(row.wrap);
  });
}

// ---------- read UI back into state ----------
function syncFromUI() {
  // kettlebells
  const kbRows = [...document.querySelectorAll("#kbList .row")];
  state.kettlebells = kbRows.map(r => {
    const inputs = r.querySelectorAll("input,select");
    return { weight: Number(inputs[0].value), qty: Number(inputs[1].value) };
  });

  // dumbbells (only the currently displayed type list is on screen)
  const type = document.getElementById("dbType").value;
  const dbRows = [...document.querySelectorAll("#dbList .row")];
  state.dumbbells[type] = dbRows.map(r => {
    const inputs = r.querySelectorAll("input,select");
    return { weight: Number(inputs[0].value), qty: Number(inputs[1].value) };
  });

  // plates
  const plateRows = [...document.querySelectorAll("#plateList .row")];
  state.plates = plateRows.map(r => {
    const inputs = r.querySelectorAll("input,select");
    return { weight: Number(inputs[0].value), qty: Number(inputs[1].value) };
  });

  // bars
  const ob = document.getElementById("olympicBar").value;
  const ez = document.getElementById("ezBar").value;
  state.bars.olympic = ob ? Number(ob) : 45;
  state.bars.ez = ez ? Number(ez) : null;
  state.bars.other = document.getElementById("otherBars").value || "";
}

function save() {
  syncFromUI();

  const kettlebells = normalizeItems(state.kettlebells);
  const dbPairs = normalizeItems(state.dumbbells.pairs);
  const dbSingles = normalizeItems(state.dumbbells.singles);
  const plates = normalizeItems(state.plates);

  // Back-compat arrays (old generator expects these sometimes)
  const kbs = kettlebells.map(x => x.weight);
  const dbs = dbPairs.map(x => x.weight);

  const payload = {
    // legacy
    dbs, kbs,
    // structured
    kettlebells,
    dumbbells: { pairs: dbPairs, singles: dbSingles },
    plates,
    bars: {
  olympic: Number.isFinite(state.bars.olympic) ? state.bars.olympic : 45,
  ez: (state.bars.ez && Number.isFinite(state.bars.ez)) ? state.bars.ez : null,
  other: state.bars.other || ""
}

  };

  localStorage.setItem(KEY, JSON.stringify(payload));
  setStatus("Saved ‚úÖ");
}

function load() {
  const saved = JSON.parse(localStorage.getItem(KEY) || "{}");

  // defaults tailored to YOU
  const defaults = {
    kettlebells: [{weight:30,qty:1},{weight:40,qty:1},{weight:50,qty:2},{weight:70,qty:1}],
    dumbbells: {
      pairs: [{weight:30,qty:2},{weight:35,qty:2},{weight:40,qty:2}],
      singles: [{weight:25,qty:1}]
    },
    plates: [{weight:45,qty:2},{weight:35,qty:2},{weight:25,qty:2},{weight:10,qty:2},{weight:5,qty:2},{weight:2.5,qty:2}],
    bars: { olympic: 45, ez: null, other: "" }
  };

  state.kettlebells =
    saved.kettlebells ||
    (saved.kbs ? saved.kbs.map(w => ({weight:w,qty:1})) : defaults.kettlebells);

  state.dumbbells =
    saved.dumbbells ||
    {
      pairs: (saved.dbs ? saved.dbs.map(w => ({weight:w,qty:2})) : defaults.dumbbells.pairs),
      singles: defaults.dumbbells.singles
    };

  state.plates = saved.plates || defaults.plates;
  state.bars = saved.bars || defaults.bars;

  // Bars fields
  document.getElementById("olympicBar").value = state.bars.olympic ?? 45;
  document.getElementById("ezBar").value = state.bars.ez ?? "";
  document.getElementById("otherBars").value = state.bars.other ?? "";

  renderKB();
  renderDB();
  renderPlates();

  setStatus(saved && Object.keys(saved).length ? "Loaded saved equipment ‚úÖ" : "Loaded defaults");
}

function resetDefaults() {
  localStorage.removeItem(KEY);
  load();
  setStatus("Reset to defaults ‚úÖ");
}

function wipeAll() {
  localStorage.removeItem(KEY);
  state = { kettlebells: [], dumbbells:{pairs:[],singles:[]}, plates:[], bars:{olympic:45,ez:null,other:""} };
  renderKB(); renderDB(); renderPlates();
  document.getElementById("olympicBar").value = 45;
  document.getElementById("ezBar").value = "";
  document.getElementById("otherBars").value = "";
  setStatus("Wiped saved data üßº");
}

// ---------- wire up ----------
document.getElementById("addKb").onclick = () => {
  state.kettlebells.push({weight:0,qty:1});
  renderKB();
};

document.getElementById("addDb").onclick = () => {
  const type = document.getElementById("dbType").value;
  state.dumbbells[type].push({weight:0,qty: type === "pairs" ? 2 : 1});
  renderDB();
};

document.getElementById("dbType").onchange = () => renderDB();

document.getElementById("addPlate").onclick = () => {
  state.plates.push({weight:0,qty:2});
  renderPlates();
};

document.getElementById("save").onclick = save;
document.getElementById("reset").onclick = resetDefaults;
document.getElementById("wipe").onclick = wipeAll;

load();
</script>
</body>
</html>

